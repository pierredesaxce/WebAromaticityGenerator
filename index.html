<!DOCTYPE html>
<html>
<head>


</head>
<body>

<form action="/action_page.php">
    <input type="file" id="inputFile" name="filename" accept=".xyz" onchange="changeDisplay()">
    <input type="submit">
</form>


<div id="display" class="flex-container">

    <p>uploaded file : </p>
    <p id="molFile"></p>


<!--
    citation needed :
    https://academic.oup.com/bioinformatics/article/31/8/1322/213186
    if I forget please remind me
-->


    <script id="molVisuScript" src="https://3Dmol.csb.pitt.edu/build/3Dmol-min.js"></script>

    <div id="preview" style="height: 300px; width: 500px;"
    class='viewer_3Dmoljs' data-datatype='xyz'
    data-backgroundcolor='0xffffff'
    data-href='randomMol.xyz'
    data-style='stick'>
    </div>



</div>



<script>

function changeDisplay() {

  const [file] = document.getElementById("inputFile").files;


  var divToDel = document.getElementById("preview");
  divToDel.parentNode.removeChild(divToDel);

  var div = document.createElement("div");

  div.id="preview";
  div.style.height = "300px";
  div.style.width = "500px";
  div.style.position = "relative";
  div.className='viewer_3Dmoljs'


  div.setAttribute('data-datatype','xyz');
  div.setAttribute('data-backgroundcolor','0xffffff');
  div.setAttribute('data-href',URL.createObjectURL(file));
  div.setAttribute('data-style','stick');


  document.getElementById("display").appendChild(div);

  document.getElementById("molFile").innerHTML = $('.viewer_3Dmoljs').data('href');


  let element = $('#preview');
  let config = { backgroundColor: '0xffffff' };

  let viewer = $3Dmol.createViewer( element, config );


  viewer.addModel($('.viewer_3Dmoljs').data('href'), "xyz");

  viewer.addSurface($3Dmol.SurfaceType.VDW, {opacity:0.85, volscheme: new $3Dmol.Gradient.RWB(-10,10)},{});

  viewer.render();
  viewer.zoomTo();



}



</script>

</body>
</html>